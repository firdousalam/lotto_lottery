<div ng-controller="invoiced_job" ng-cloak>
<div class="row">
	<div class="col-lg-12" style="margin-top:16px; min-height:750px;">
		<div class="panel panel-green margin-bottom-10">
			<div class="panel-heading">
				<h3 class="panel-title"><i class="fa fa-tasks"></i> Invoiced Job Details
					<span  class="pull-right">Amount : {{business_setting_details.currency.symbol}} &nbsp;{{total_invoiced_job_amount | number:2 }} </span>
					<i class="fa fa-file-pdf-o fa-2x pull-right" style="cursor: pointer; font-size: 26px; line-height: 11px;" ng-click="openGenerateInvoicedJobPDFData()" style="cursor:pointer;" tooltips tooltip-side="right" tooltip-template="Export invoiced job data to PDF format."></i>&nbsp;&nbsp;
					<i class="fa fa-file-excel-o fa-2x pull-right" style="cursor: pointer; font-size: 26px; line-height: 11px;" ng-click="generateInvoicedJobCSVData()" style="cursor:pointer;" tooltips tooltip-side="right" tooltip-template="Export invoiced job data to CSV format."></i>&nbsp;&nbsp;
				</h3>
			</div>
			<!-- Search Box. -->
			<div class="panel-body text-center">
				<div class="col-sm-4 col-sm-offset-4">
					<div id="imaginary_container">
						<div class="input-group stylish-input-group">
							<input type="text" class="form-control"  ng-model="search" placeholder="Search">
							<span class="input-group-addon">
								<button type="submit"> <span class="glyphicon glyphicon-search"></span> </button>
							</span> 
						</div>
					</div>
				</div>
			</div>
			<div class="table-responsive">
				<table  class="table table-striped table-bordered table-hover">
					<thead>
						<tr>
							<th ng-click="sortInvoicedJobTableBy('jobs.job_id')">
								Job ID
								<span class="glyphicon sort-icon" ng-show="sortKey=='jobs.job_id'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
								<span class="glyphicon sort-icon" ng-hide="sortKey=='jobs.job_id'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
							</th>
							<th ng-click="sortInvoicedJobTableBy('customer_id.name')">
								Customer Name
								<span class="glyphicon sort-icon" ng-show="sortKey=='customer_id.name'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
								<span class="glyphicon sort-icon" ng-hide="sortKey=='customer_id.name'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
							</th>
							<th ng-click="sortInvoicedJobTableBy('jobs.job_status')">
								Status
								<span class="glyphicon sort-icon" ng-show="sortKey=='jobs.job_status'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
								<span class="glyphicon sort-icon" ng-hide="sortKey=='jobs.job_status'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
							</th>
							<th ng-click="sortInvoicedJobTableBy('jobs.job_date')">
								Date & Time
								<span class="glyphicon sort-icon" ng-show="sortKey=='jobs.job_date'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
								<span class="glyphicon sort-icon" ng-hide="sortKey=='jobs.job_date'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
							</th>
							<th>
								Extra
							<!--	<span class="glyphicon sort-icon" ng-show="sortKey=='customer_id.type'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
								<span class="glyphicon sort-icon" ng-hide="sortKey=='customer_id.type'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span> -->
							</th>
							<th ng-click="sortInvoicedJobTableBy('jobs.pax_first_name')">
								Pax Details
								<span class="glyphicon sort-icon" ng-show="sortKey=='jobs.pax_first_name'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
								<span class="glyphicon sort-icon" ng-hide="sortKey=='jobs.pax_first_name'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
							</th>
							<th ng-click="sortInvoicedJobTableBy('jobs.from_address.label')">
								From&nbsp;
								<span class="glyphicon sort-icon" ng-show="sortKey=='jobs.from_address.label'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
								<span class="glyphicon sort-icon" ng-hide="sortKey=='jobs.from_address.label'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
							</th>
							<th ng-click="sortInvoicedJobTableBy('jobs.to_address.label')">
								To&nbsp;
								<span class="glyphicon sort-icon" ng-show="sortKey=='jobs.to_address.label'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
								<span class="glyphicon sort-icon" ng-hide="sortKey=='jobs.to_address.label'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
							</th>
							<th ng-click="sortInvoicedJobTableBy('jobs.payment_status')">
								Payment&nbsp;
								<span class="glyphicon sort-icon" ng-show="sortKey=='jobs.payment_status'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
								<span class="glyphicon sort-icon" ng-hide="sortKey=='jobs.payment_status'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
							</th>
							<th ng-click="sortInvoicedJobTableBy('jobs.fare[0].total_fare')">
								Fare&nbsp;
								<span class="glyphicon sort-icon" ng-show="sortKey=='jobs.fare[0].total_fare'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
								<span class="glyphicon sort-icon" ng-hide="sortKey=='jobs.fare[0].total_fare'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
							</th>
							<th ng-click="sortInvoicedJobTableBy('jobs.driver[0].driver_id.first_name')">
								Driver&nbsp;
								<span class="glyphicon sort-icon" ng-show="sortKey=='jobs.driver[0].driver_id.first_name'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
								<span class="glyphicon sort-icon" ng-hide="sortKey=='jobs.driver[0].driver_id.first_name'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
							</th>
						</tr>
					</thead>
					<tbody>   
						<tr>
							<td colspan="13"><div ng-show="loader" style="position: fixed;left: 0px;top: 0px;width: 100%;height: 100%;z-index: 9999;background: url(http://www.limokit.com/bms_clients/repo/images/load.gif) center no-repeat;"></div></td>
						</tr>
					</tbody>
					<tbody><!--orderBy:'-invoice_id'-->
						<tr dir-paginate="invoiced_job in invoiced_job_details|orderBy:sortKey:reverse|filter:search|itemsPerPage:selected_search_type_per_page">
							<tr><td colspan="12" ng-show="!invoiced_job_details.length" style="align:center"><b>No Data Available.</b></td></tr>
							<tr ng-repeat="invoiced_job in invoiced_job_details|orderBy:sort_table:reverse|filter:search|itemsPerPage:selected_search_type_per_page">
								<td>{{invoiced_job.jobs.job_id}}</td>
								<td>{{invoiced_job.customer_id.name}}</td>
								<td>{{invoiced_job.jobs.job_status}}</td>
								<td>{{invoiced_job.jobs.job_date | date : "dd-MM-yyyy"}}&nbsp; {{invoiced_job.jobs.pickup_date_time.pickup_time}}</td>
								<td>
									<span ng-repeat="extra in invoiced_job.jobs.extras">{{extra.extra_type_id.name}} : {{extra.extra_nos}}</br></span>
								</td>
								<td>{{invoiced_job.jobs.pax_first_name}} &nbsp; {{invoiced_job.jobs.pax_last_name}}</td>
								
								<td>{{invoiced_job.jobs.from_address.label}} &nbsp; {{invoiced_job.jobs.from_address.line_1}}&nbsp;{{invoiced_job.jobs.from_address.line_2}}&nbsp;
									{{invoiced_job.jobs.from_address.suburb_district}}&nbsp;{{invoiced_job.jobs.from_address.post_code}}&nbsp;
									{{invoiced_job.jobs.from_address.state}}&nbsp;{{invoiced_job.jobs.from_address.country}}
								</td>
								<td>{{invoiced_job.jobs.to_address.label}} &nbsp; {{invoiced_job.jobs.to_address.line_1}}&nbsp;{{invoiced_job.jobs.to_address.line_2}}&nbsp;
									{{invoiced_job.jobs.to_address.suburb_district}}&nbsp;{{invoiced_job.jobs.to_address.post_code}}&nbsp;
									{{invoiced_job.jobs.to_address.state}}&nbsp;{{invoiced_job.jobs.to_address.country}}
								</td>
								<td>{{invoiced_job.jobs.payment_status}}</td>
								<td style="align=right">{{business_setting_details.currency.symbol}}{{invoiced_job.jobs.fare[0].total_fare | number:2}}</td>
								<td>{{invoiced_job.jobs.driver[0].driver_id.title}}&nbsp;{{invoiced_job.jobs.driver[0].driver_id.first_name}}&nbsp;{{invoiced_job.jobs.driver[0].driver_id.last_name}}</td>
							</tr>
						</tr>
					</tbody>
				</table><!-- end of main table-->
			</div><!-- end of main table div> -->
		</div><!-- end of main panel-->
	<div class="pull-left">
		<div class="dataTables_length" id="dataTables-example_length">
			<div class="bms-form" style="border:0;">
				<label>Show</label>
				<label class="select">
					<select ng-model="selected_search_type_per_page" 
									ng-options="search.value as search.name for search in page_per_pagination" 
									ng-init="selected_search_type_per_page=selected_page_pagination">
									<option value="">Select no of rows</option>  
					</select>
					<i></i>
				</label>
			</div>
		</div>
	</div>
	<ul class="pagination pull-right">
		<dir-pagination-controls
								max-size="5"
								direction-links="true"
								boundary-links="true" >
		</dir-pagination-controls>
	</ul>
	<!-- Below modal show the data generated for pdf. -->
	<modal title="Invoiced Job Data" visible="invoiced_job_pdf_modal">
		<div class="panel-heading">
			<h3>
				<button type="button" onclick="javascript:generatesInvoicedJobPDF()" class="btn btn-default btn-xs pull-right" id="create_pdf"><i class="fa fa-file-pdf-o"></i>Generate PDF</button>
			</h3>
		</div>
		<div class="panel-body text-center">
			<div class="table-responsive">
				<table class="table table-striped table-bordered table-hover" id="invoicedjoblist">
					<thead>
						<tr>
							<th>Job</th>
							<th>Customer/Pax</th>
							<th>Payment</th>
							<th>Driver</th>
							<th>From/To</th>
							<th>Extras</th>
						</tr>
					</thead>
					<tbody>
<!-- IMPORTANT : Donot indent, indentation will lead to broken row structure in the generated PDF. -->
						<tr ng-repeat="invoiced_job in invoiced_job_details | orderBy:sort_table:reverse | filter:search">
								<td>
{{invoiced_job.jobs.job_id}}
</br>
{{invoiced_job.jobs.job_status | uppercase}}
</br>
{{invoiced_job.jobs.job_date | date : "dd-MM-yyyy"}}&nbsp; {{invoiced_job.jobs.pickup_date_time.pickup_time}}
</br>
{{business_setting_details.currency.symbol}}{{invoiced_job.jobs.fare[0].total_fare | number:2}}
							</td>
							<td>
{{invoiced_job.customer_id.name}}
							</br>
{{invoiced_job.jobs.pax_first_name}} &nbsp; {{invoiced_job.jobs.pax_last_name}}
							</td>
							<td>
{{invoiced_job.jobs.payment_status}}
							</td>
							<td>
{{invoiced_job.jobs.driver[0].driver_id.title}}&nbsp;{{invoiced_job.jobs.driver[0].driver_id.first_name}}&nbsp;{{invoiced_job.jobs.driver[0].driver_id.last_name}}
							</td>
							<td>
{{invoiced_job.jobs.from_address.label}} &nbsp; {{invoiced_job.jobs.from_address.line_1}}&nbsp;{{invoiced_job.jobs.from_address.line_2}}&nbsp;{{invoiced_job.jobs.from_address.suburb_district}}&nbsp;{{invoiced_job.jobs.from_address.post_code}}&nbsp;{{invoiced_job.jobs.from_address.state}}&nbsp;{{invoiced_job.jobs.from_address.country}}
</br>
{{invoiced_job.jobs.to_address.label}} &nbsp; {{invoiced_job.jobs.to_address.line_1}}&nbsp;{{invoiced_job.jobs.to_address.line_2}}&nbsp;{{invoiced_job.jobs.to_address.suburb_district}}&nbsp;{{invoiced_job.jobs.to_address.post_code}}&nbsp;{{invoiced_job.jobs.to_address.state}}&nbsp;{{invoiced_job.jobs.to_address.country}}
							</td>
							<td>
<span ng-repeat="extra in invoiced_job.jobs.extras">{{extra.extra_type_id.name}} : {{extra.extra_nos}},&nbsp;</span>
							</td>
						</tr>
<!-- END PDF ROW. -->
					</tbody>
				</table>
			</div>
		</div>
	</modal>
</div>
<div class="clearfix"></div>
<script>
function generatesInvoicedJobPDF() 
{
    var doc = new jsPDF('l', 'pt');
    doc.text("Invoiced Job List", 10, 50);
	var res = doc.autoTableHtmlToJson(document.getElementById("invoicedjoblist"));
	doc.autoTable(res.columns, res.data, {startY: 60,margin: {horizontal: 10},styles: {overflow: 'linebreak'},bodyStyles: {valign: 'top'}});
	doc.save('invoiced-job-data.pdf');
}
</script>